<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>게시글 관리</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f4f4f9;
      }
      header {
        background-color: #333;
        color: white;
        padding: 15px;
        text-align: center;
      }
      .container {
        width: 80%;
        margin: 20px auto;
      }
      .form-group {
        margin-bottom: 15px;
      }
      label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
      }
      input, textarea {
        width: 100%;
        padding: 10px;
        margin: 5px 0;
        border: 1px solid #ccc;
        border-radius: 4px;
      }
      button {
        padding: 10px 20px;
        background-color: #4CAF50;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
      button:hover {
        background-color: #45a049;
      }
      .articles {
        margin-top: 30px;
      }
      .article {
        background-color: #fff;
        padding: 15px;
        margin-bottom: 15px;
        border-radius: 4px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .article h3 {
        margin-top: 0;
      }
      .article p {
        color: #555;
      }
      .delete-btn {
        background-color: #f44336;
        color: white;
        border: none;
        padding: 5px 10px;
        cursor: pointer;
        border-radius: 4px;
      }
      .delete-btn:hover {
        background-color: #e53935;
      }
      .alert {
        padding: 10px;
        margin: 20px 0;
        background-color: #f4f4f9;
        border-radius: 4px;
        color: #333;
        border: 1px solid #ccc;
      }
      .alert.success {
        background-color: #d4edda;
        color: #155724;
        border-color: #c3e6cb;
      }
      .alert.error {
        background-color: #f8d7da;
        color: #721c24;
        border-color: #f5c6cb;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>게시글 관리</h1>
    </header>

    <div class="container">
      <div id="message" class="alert" style="display: none;"></div>

      <h2>새 게시글 작성</h2>
      <form id="articleForm">
        <div class="form-group">
          <label for="title">제목</label>
          <input type="text" id="title" name="title" required>
        </div>
        <div class="form-group">
          <label for="content">내용</label>
          <textarea id="content" name="content" rows="4" required></textarea>
        </div>
        <div class="form-group">
          <label for="author_id">작성자 ID</label>
          <input type="number" id="author_id" name="author_id" required>
        </div>
        <button type="submit">게시글 업로드</button>
      </form>

      <h2>로그인</h2>
      <form id="loginForm">
        <div class="form-group">
          <label for="loginEmail">이메일</label>
          <input type="email" id="loginEmail" name="email" required>
        </div>
        <div class="form-group">
          <label for="loginPassword">비밀번호</label>
          <input type="password" id="loginPassword" name="password" required>
        </div>
        <button type="submit">로그인</button>
      </form>

      <h2>회원가입</h2>
      <form id="signupForm">
        <div class="form-group">
          <label for="signupEmail">이메일</label>
          <input type="email" id="signupEmail" name="email" required>
        </div>
        <div class="form-group">
          <label for="signupPassword">비밀번호</label>
          <input type="password" id="signupPassword" name="password" required>
        </div>
        <button type="submit">회원가입</button>
      </form>

      <h2>게시글 목록</h2>
      <div id="articlesList"></div>
      </div>

    <script>
      const apiUrl = 'http://localhost:3000/articles'; // API URL 설정
      const articleForm = document.getElementById('articleForm');
      const loginForm = document.getElementById('loginForm');
      const signupForm = document.getElementById('signupForm');
      const messageDiv = document.getElementById('message');
      const articlesList = document.getElementById('articlesList');

      // 게시글 목록 조회
      async function fetchArticles() {
        try {
          const response = await fetch(apiUrl);
          const articles = await response.json();
          displayArticles(articles);
        } catch (error) {
          console.error('Error fetching articles:', error);
        }
      }

      // 게시글 출력 함수
      function displayArticles(articles) {
        articlesList.innerHTML = ''; // 기존 게시글 목록 초기화
        articles.forEach(article => {
          const articleDiv = document.createElement('div');
          articleDiv.classList.add('article');
          articleDiv.setAttribute('data-id', article.id);
          articleDiv.innerHTML = `
            <h3>${article.title}</h3>
            <p>${article.content}</p>
            <p><strong>작성자 ID:</strong> ${article.author_id}</p>
            <p><strong>작성일:</strong> ${new Date(article.date).toLocaleString()}</p>
            <button class="delete-btn" onclick="deleteArticle(${article.id})">삭제</button>
            <button class="delete-btn" onclick="editArticle(${article.id})">수정</button>
          `;
          articlesList.appendChild(articleDiv);
        });
      }

      // 게시글 업로드
      articleForm.addEventListener('submit', async (event) => {
        event.preventDefault();

        const title = document.getElementById('title').value;
        const content = document.getElementById('content').value;
        const author_id = document.getElementById('author_id').value;

        const newArticle = { title, content, author_id };

        try {
          const response = await fetch(apiUrl, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(newArticle)
          });

          const result = await response.json();
          if (response.ok) {
            displayMessage('게시글이 성공적으로 업로드되었습니다.', 'success');
            fetchArticles(); // 게시글 목록 새로고침
            articleForm.reset(); // 폼 초기화
          } else {
            displayMessage(result.error, 'error');
          }
        } catch (error) {
          console.error('Error creating article:', error);
          displayMessage('게시글 업로드에 실패했습니다.', 'error');
        }
      });

      // 게시글 삭제
      async function deleteArticle(id) {
        try {
          const response = await fetch(`${apiUrl}/${id}`, {
            method: 'DELETE'
          });

          const result = await response.json();
          if (response.ok) {
            displayMessage('게시글이 삭제되었습니다.', 'success');
            fetchArticles(); // 게시글 목록 새로고침
          } else {
            displayMessage(result.error, 'error');
          }
        } catch (error) {
          console.error('Error deleting article:', error);
          displayMessage('게시글 삭제에 실패했습니다.', 'error');
        }
      }

      // 로그인
      loginForm.addEventListener('submit', async (event) => {
        event.preventDefault();

        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;

        try {
          const response = await fetch('http://localhost:3000/login', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ email, password })
          });

          const result = await response.json();
          if (response.ok) {
            displayMessage('로그인 성공!', 'success');
            localStorage.setItem("token", result.token); // 토큰 저장
          } else {
            displayMessage(result.error, 'error');
          }
        } catch (error) {
          console.error('Login error:', error);
          displayMessage('로그인에 실패했습니다.', 'error');
        }
      });

      // 회원가입
      signupForm.addEventListener('submit', async (event) => {
        event.preventDefault();

        const email = document.getElementById('signupEmail').value;
        const password = document.getElementById('signupPassword').value;

        try {
          const response = await fetch('http://localhost:3000/signup', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ email, password })
          });

          const result = await response.json();
          if (response.ok) {
            displayMessage('회원가입 성공!', 'success');
          } else {
            displayMessage(result.error, 'error');
          }
        } catch (error) {
          console.error('Signup error:', error);
          displayMessage('회원가입에 실패했습니다.', 'error');
        }
      });

      // 메시지 표시 함수
      function displayMessage(message, type) {
        messageDiv.style.display = 'block';
        messageDiv.textContent = message;
        messageDiv.className = `alert ${type}`;
      }

      // 초기화 및 게시글 목록 조회
      fetchArticles();
    </script>
  </body>
</html>
